<div class="container-fluid my-links">
  <h3>My Links</h3>
    <% if @links.any? %>
    <div class="panel-group" id="accordion" role="tablist" 
      aria-multiselectable="true">
      <% @links.each do |link| %>
        <div class="panel panel-default">
          <div class="panel-heading" role="tab" id="heading<%= link.id %>">
            <h4 class="panel-title">
            <div class="row flex-items-xs-middle">
              <div class="col-md-9">
                <%= link_to link.title, link.shortened_url, target: "_blank" %> 
                <%= " - " + link.shortened_url %>
              </div>
              <a class= "collapsed col-md-1 "role="button" 
                data-toggle="collapse" data-parent="#accordion" 
                href="#collapse-detail<%= link.id %>" aria-expanded="true" 
                aria-controls="collapse-detail<%= link.id %>">Details</a>
              <a class= "collapsed col-md-1 "role="button" 
                data-toggle="collapse" data-parent="#accordion" 
                href="#collapse-edit<%= link.id %>" aria-expanded="true" 
                aria-controls="collapse-edit<%= link.id %>">Edit</a>
              <div class="delete-link col-md-1">
                <%= link_to 'Delete', link, method: :delete, 
                  data: { confirm: 'Are you sure?' } %>
              </div>
            </div>
            </h4>
          </div>
          <div id="collapse-detail<%= link.id %>" class="panel-collapse collapse" 
            role="tabpanel" aria-labelledby="heading<%= link.id %>">
            <div class="panel-body">
              <h4>Total visits to link: <%= link.visit_count %></h4>
              <table class="table table-hover">
                <thead>
                  <tr>
                    <td>Username</td>
                    <td>IP Address</td>
                    <td>Date Visited</td>
                  </tr>
                </thead>
                <tbody>
                  <% link.visits.each do |visit| %>
                  <tr>
                    <td><%= visit.user ? visit.user.username : "Anonymous" %></td>
                    <td><%= visit.ip_address %></td>
                    <td><%= visit.created_at %></td>
                  </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
          <div id="collapse-edit<%= link.id %>" class="panel-collapse collapse" 
          role="tabpanel" aria-labelledby="heading<%= link.id %>">
            <div class="panel-body">
            <%= form_for link, remote: true do |f| %>
              Original URL : 
              <%= f.url_field :original, required: true, class: "form-control" %>
              <div class="row">
                <div class="col-md-6">
                  <label>Set Vanity String Slug: </label> 
                  <%= f.text_field :slug, required: true%>
                </div>
                <div class="col-md-2">
                  <label>Activate Link: </label>
                  <%= f.check_box :active, class: "checkbox-lg" %>
                </div>
              </div>
              <div id="update-error"></div>
              <%= f.submit "Update Link", class: "btn btn-primary" %>
            <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <% else %>
      <p> You have not shortened any links </p>
  <% end %>
</div>
